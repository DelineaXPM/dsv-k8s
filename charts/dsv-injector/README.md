# dsv-injector

![Version: v1.2.4](https://img.shields.io/badge/Version-v1.2.4-informational?style=flat-square) ![Type: application](https://img.shields.io/badge/Type-application-informational?style=flat-square) ![AppVersion: latest](https://img.shields.io/badge/AppVersion-latest-informational?style=flat-square)

A Helm chart for the Delinea DevOps Secrets Vault (DSV) Injector Mutating Webhook.

```shell
NAMESPACE='dsv'
CREDENTIALS_JSON_FILE='.cache/credentials.json' # replace with your credentials file
IMAGE_REPOSITORY='docker.io/delineaxpm/dsv-k8s'
IMAGE_TAG='v1.2.4' # use latest for test, but pin to a specific version for production

helm install \
    --namespace $NAMESPACE \
    --create-namespace \
    --set-file credentialsJson=${CREDENTIALS_JSON_FILE} \
    --set image.repository=${IMAGE_REPOSITORY} \
    --set image.tag=${IMAGE_TAG} \
    --atomic \
    --timeout "5m" \
    --debug -v4 \ # optional for local test iteration --values .cache/charts/dsv-injector/values.yaml \
    dsv-injector ./charts/dsv-injector
```

An upgrade to the existing deployment can be done with:

```shell
helm upgrade \
  --namespace $NAMESPACE \
  --atomic \
  --timeout "5m" \
  --debug -v4 \
  dsv-injector ./charts/dsv-injector
```

To upgrade, ensuring that the current self signed cert that is deployed by default (if not using your own CA), run the commands below to ensure the prior hook and secret are removed so they can be recreated with the newly generated cert.

```shell
kubectl --namespace $NAMESPACE delete mutatingwebhookconfiguration dsv-injector \
&& kubectl --namespace $NAMESPACE delete secret --timeout "5m" dsv-injector-tls \
&& helm upgrade \
  --namespace $NAMESPACE \
  --atomic \
  --timeout "5m" \
  --debug -v4 \
  dsv-injector ./charts/dsv-injector
```

To uninstall the deployment, you can run:

```shell
helm uninstall --namespace $NAMESPACE dsv-injector
```

## Maintainers

| Name             | Email | Url |
| ---------------- | ----- | --- |
| Sheldon Hull     |       |     |
| Delinea DSV Team |       |     |

## Values

| Key                                    | Type   | Default                                                                                                                                               | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| -------------------------------------- | ------ | ----------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| configmap                              | object | {} empty.                                                                                                                                             | configmap are configuration values for the app to load. All of these are defaulted in the template itself and only need be set if adjusting. Since the user for the container is nonroot, only edit if you know what you are doing. Boolean values should be passed quoted to avoid issues.                                                                                                                                                                                                                                                                      |
| containerPort                          | int    | `18543`                                                                                                                                               | containerPort is the port that the container itself listens on                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| credentialsJson                        | string | `"{\n  \"default\": {\n    \"credentials\": {\n      \"clientId\": \"\",\n      \"clientSecret\": \"\"\n    },\n    \"tenant\": \"example\"\n  }\n}"` | credentialsJson contains the JSON-formatted credentials file (see README.md) @default - placeholder. _REQUIRED FIELD_                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| fullnameOverride                       | string | `""`                                                                                                                                                  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| image.entrypoint                       | string | `"/app/dsv-injector"`                                                                                                                                 | Entrypoint is the path to the binary. Since the container image could contain multiple binaries, this makes sure it's correctly mapped to the binary.                                                                                                                                                                                                                                                                                                                                                                                                            |
| image.pullPolicy                       | string | IfNotPresent                                                                                                                                          | pullPolicy is the image pull policy. If running locally built images, you'll want to set to Never to ensure local loaded images are used. Local testing use: `Never`.                                                                                                                                                                                                                                                                                                                                                                                            |
| image.repository                       | string | `"docker.io/delineaxpm/dsv-k8s"`                                                                                                                      |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| image.tag                              | string | the current app version/chart version                                                                                                                 | Overrides the image tag whose default is the chart appVersion. Local Testing: Use `latest`.                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| imagePullSecrets                       | list   | `[]`                                                                                                                                                  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| nameOverride                           | string | `""`                                                                                                                                                  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| podAnnotations                         | object | `{}`                                                                                                                                                  | podAnnotations @default - Includes `dsv-filter-name` for easier log selector filter.                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| podSecurityContext                     | object | `{}`                                                                                                                                                  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| replicaCount                           | int    | `1`                                                                                                                                                   | replicate count @default - 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| resources                              | object | No default values, user must specify to set resource limits.                                                                                          | We usually recommend not to specify default resources and to leave this as a conscious choice for the user. This also increases chances charts run on environments with little resources, such as Minikube. If you do want to specify resources, uncomment the following lines, adjust them as necessary, and remove the curly braces after 'resources:'.                                                                                                                                                                                                        |
| securityContext                        | object | `{"readOnlyRootFilesystem":true,"runAsGroup":65532,"runAsNonRoot":true,"runAsUser":65532}`                                                            | securityContext is the security context for the controller. This uses chainguard static nonroot based image. Reference: https://edu.chainguard.dev/chainguard/chainguard-images/reference/static/overview/                                                                                                                                                                                                                                                                                                                                                       |
| securityContext.readOnlyRootFilesystem | bool   | true                                                                                                                                                  | readOnlyRootFilesystem is the read only root file system flag.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| securityContext.runAsGroup             | int    | 65532 (from chainguard static image)                                                                                                                  | runAsGroup is the run as group.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| securityContext.runAsNonRoot           | bool   | true                                                                                                                                                  | runAsNonRoot is the run as non root flag.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| securityContext.runAsUser              | int    | 65532 (from chainguard static image)                                                                                                                  | runAsUser is the run as user.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| service.port                           | int    | `8543`                                                                                                                                                | Default port for the injector webhook service. @default -- port 8543                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| service.type                           | string | `"ClusterIP"`                                                                                                                                         | ClusterIP is typical when the webhook is running as a POD However, it can also be hosted externally, which is useful for debugging, by providing the following instead: type: ExternalName externalName: my.fqdn So long as: - my.fqdn hosts an HTTPS endpoint on port {webhookPort} that answers URI {webhookUri} - the certificate must have a Subject Alternative Name for {name}.{namespace}.{svc}, e.g., dsv-injector.dsv.svc - the caBundle must be a base64 string containing a PEM-encoded certificate chain that validates the certifcate caBundle: ... |
| webhookCertExpireDays                  | int    | 365                                                                                                                                                   | webhookCertExpireDays specifies the number of days before the webhook certificate expires                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| webhookPort                            | int    | 8543                                                                                                                                                  | webhookPort is the port that the webhook endpoint is listening on                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| webhookScope                           | string | "Namespaced"                                                                                                                                          | webhookScope specifies which resources are in scope, "Cluster", "Namespaced" or "\*"                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| webhookUri                             | string | `"/inject"`                                                                                                                                           | webhookUri is path portion of the URL of the webhook endpoint                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |

---

Autogenerated from chart metadata using [helm-docs v1.14.2](https://github.com/norwoodj/helm-docs/releases/v1.14.2)
